---
title: "Deno＋LINEでオウム返しBotを作ってみよう"
emoji: "🦔"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Deno", "Deno Deploy", "LINE Bot", "Messaging API"]
published: false
---

## はじめに

[Deno](https://deno.land/)でオウム返しBotを作ってみます。
最近ベータ版が公開された[Deno Deploy](https://deno.com/deploy)を利用します。

<blockquote class="twitter-tweet" data-conversation="none" data-theme="light"><p lang="ja" dir="ltr">オウム返し動いた！<a href="https://t.co/7eyWN5mAun">https://t.co/7eyWN5mAun</a><a href="https://twitter.com/hashtag/deno_ja?src=hash&amp;ref_src=twsrc%5Etfw">#deno_ja</a> <a href="https://twitter.com/hashtag/protoout?src=hash&amp;ref_src=twsrc%5Etfw">#protoout</a> <a href="https://twitter.com/hashtag/line?src=hash&amp;ref_src=twsrc%5Etfw">#line</a> <a href="https://twitter.com/hashtag/linedc?src=hash&amp;ref_src=twsrc%5Etfw">#linedc</a></p>&mdash; Takahiro Mitsuoka@非接触睡眠計測デバイス&quot;Spleeng&quot;開発中 (@tmitsuoka0423) <a href="https://twitter.com/tmitsuoka0423/status/1378279511893057538?ref_src=twsrc%5Etfw">April 3, 2021</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

## LINE Bot(チャネル)を作成する

[Messaging APIを始めよう/LINE Developersコンソールでチャネルを作成する](https://developers.line.biz/ja/docs/messaging-api/getting-started/#using-console)を参考にチャネルを作成します。

チャネルを作成したら、[チャネルアクセストークンを発行する](https://developers.line.biz/ja/docs/messaging-api/building-bot/#line-developers%E3%82%B3%E3%83%B3%E3%82%BD%E3%83%BC%E3%83%AB%E3%81%A6%E3%82%99%E3%83%9B%E3%82%99%E3%83%83%E3%83%88%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B)を参考に、チャネルアクセストークンを発行してコピーしておきます。

## プログラムをDeno Deployにデプロイする

[こちら](https://github.com/tmitsuoka0423/deno-line-bot/blob/master/index.js)のプログラムをForkしておきます。
(Deno Deployにデプロイするには、URLでアクセスできる必要があります。GitHubに公開しておくのがオススメです。)

ForkできたらRawのURLをコピーしておきます。

<a href="https://gyazo.com/c0b300edec538fe4d04c47ff7c13b8b6"><img src="https://i.gyazo.com/c0b300edec538fe4d04c47ff7c13b8b6.png" alt="Image from Gyazo" width="1149"/></a>

<a href="https://gyazo.com/58bd130ad738fef934f1726f19accaff"><img src="https://i.gyazo.com/58bd130ad738fef934f1726f19accaff.png" alt="Image from Gyazo" width="1093"/></a>

続いて[Deno Deploy](https://deno.com/deploy)を開き、プロジェクトを作成します。

<a href="https://gyazo.com/c197ba9ded2ac144d31d353f09ba227d"><img src="https://i.gyazo.com/c197ba9ded2ac144d31d353f09ba227d.png" alt="Image from Gyazo" width="969"/></a>

<a href="https://gyazo.com/0671e4589f20570982a04b2b475c1d40"><img src="https://i.gyazo.com/0671e4589f20570982a04b2b475c1d40.png" alt="Image from Gyazo" width="969"/></a>

<a href="https://gyazo.com/9da07457f5fb0af1d13378940a56949d"><img src="https://i.gyazo.com/9da07457f5fb0af1d13378940a56949d.png" alt="Image from Gyazo" width="969"/></a>

さきほどコピーしたURLを貼り付けて、`Link`をクリックします。

<a href="https://gyazo.com/553fa5767f083380981fe030e52f1142"><img src="https://i.gyazo.com/553fa5767f083380981fe030e52f1142.png" alt="Image from Gyazo" width="870"/></a>

> Failed to link projectと表示された方は、[こちら](https://qiita.com/tmitsuoka0423/items/2f8392a3ed3e4ffefdfa#%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%99%E3%82%8B%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E7%99%BB%E9%8C%B2%E3%81%99%E3%82%8B)の手順を参考にアクセス権を付与してください。

環境変数を登録します。

- Key: `CHANNEL_ACCESS_TOKEN`, Value: LINE Botチャネルページのチャネルアクセストークン

<a href="https://gyazo.com/80a02ae57a230bfbbef31c8e22846823"><img src="https://i.gyazo.com/80a02ae57a230bfbbef31c8e22846823.png" alt="Image from Gyazo" width="1011"/></a>

`Visit`を右クリックし、URLをコピーします。

<a href="https://gyazo.com/0183d77633133ebb11c73b534feb3a12"><img src="https://i.gyazo.com/0183d77633133ebb11c73b534feb3a12.png" alt="Image from Gyazo" width="901"/></a>

[こちら](https://developers.line.biz/ja/docs/messaging-api/building-bot/#setting-webhook-url)を参考に、LINE BotのWebhook URLに貼り付けます。

こんな感じ。

<a href="https://gyazo.com/2470221d56f818cd5aff89119cb74aab"><img src="https://i.gyazo.com/2470221d56f818cd5aff89119cb74aab.png" alt="Image from Gyazo" width="1011"/></a>

`検証`をクリックして、成功することを確認します。

<a href="https://gyazo.com/c514c1e5b221e658ed10c9cd416e971c"><img src="https://i.gyazo.com/c514c1e5b221e658ed10c9cd416e971c.png" alt="Image from Gyazo" width="1011"/></a>

以上で設定はおしまいです。

## 動作確認

オウム返しが動きました。

<blockquote class="twitter-tweet" data-conversation="none" data-theme="light"><p lang="ja" dir="ltr">オウム返し動いた！<a href="https://t.co/7eyWN5mAun">https://t.co/7eyWN5mAun</a><a href="https://twitter.com/hashtag/deno_ja?src=hash&amp;ref_src=twsrc%5Etfw">#deno_ja</a> <a href="https://twitter.com/hashtag/protoout?src=hash&amp;ref_src=twsrc%5Etfw">#protoout</a> <a href="https://twitter.com/hashtag/line?src=hash&amp;ref_src=twsrc%5Etfw">#line</a> <a href="https://twitter.com/hashtag/linedc?src=hash&amp;ref_src=twsrc%5Etfw">#linedc</a></p>&mdash; Takahiro Mitsuoka@非接触睡眠計測デバイス&quot;Spleeng&quot;開発中 (@tmitsuoka0423) <a href="https://twitter.com/tmitsuoka0423/status/1378279511893057538?ref_src=twsrc%5Etfw">April 3, 2021</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

## まとめ

- Deno + Deno DeployでLINE Botを動かしました。
- Node.jsのSDKが使えないので、HTTPのエンドポイントを直接叩いています。
- DenoのSDK欲しい。
